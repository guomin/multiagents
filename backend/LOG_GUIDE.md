# 智能体日志查看指南

本文档说明如何查看策划智能体和空间设计智能体的详细输入输出日志。

## 📋 日志内容概览

### 策划智能体 (Curator Agent)

每个执行周期包含以下日志信息：

#### 1. 开始标记
```
═══════════════════════════════════════════════════════════
🎨 [策划智能体] 开始生成概念策划方案
═══════════════════════════════════════════════════════════
```

#### 2. 输入参数
- **📥 [输入参数] 原始需求**：用户提供的展览需求（标题、主题、受众、场地等）
- **📥 [输入详情] 完整需求对象**：完整的需求JSON对象
- **修订原因**：如果有修订，会显示修订原因

#### 3. 提示词信息
- **📝 [提示词] Prompt 版本**：提示词版本号、长度信息
- **📝 [提示词] 系统提示词**：完整的系统提示词内容
- **📝 [提示词] 用户提示词**：完整的用户提示词内容（包含所有变量注入）

#### 4. LLM调用
- **🤖 [LLM调用] 准备调用大模型**：模型名称、温度、提供商等
- **🤖 [LLM调用] 大模型响应完成**：响应长度、耗时、Token使用量

#### 5. LLM原始输出
- **📤 [LLM原始输出] 未解析的原始响应**：LLM返回的完整原始内容

#### 6. 解析过程
- **🔧 [解析开始]**：开始解析LLM响应
- **🔧 [解析方式]**：JSON解析或文本提取
- **🔧 [解析成功]**：解析后的完整JSON对象

#### 7. 最终输出
- **📤 [最终输出] 概念策划方案**：
  - `concept`：核心概念
  - `narrative`：叙事结构
  - `keyExhibits`：重点展品列表
  - `visitorFlow`：参观流线设计

- **📤 [输出详情] 完整概念策划对象**：完整的输出JSON

#### 8. 完成标记
```
═══════════════════════════════════════════════════════════
✅ [策划智能体] 概念策划生成完成
- 总耗时
- LLM耗时
- 解析耗时
═══════════════════════════════════════════════════════════
```

---

### 空间设计智能体 (Spatial Designer Agent)

每个执行周期包含以下日志信息：

#### 1. 开始标记
```
═══════════════════════════════════════════════════════════
🏗️ [空间设计智能体] 开始生成空间布局方案
═══════════════════════════════════════════════════════════
```

#### 2. 输入参数
- **📥 [输入参数] 原始需求**：用户提供的展览需求
- **📥 [输入参数] 策划方案（来自策划智能体）**：
  - `concept`：策划的核心概念
  - `narrative`：策划的叙事结构
  - `keyExhibits`：策划的重点展品
  - `visitorFlow`：策划的参观流线理念
- **📥 [输入详情] 完整需求对象**：完整的需求JSON
- **📥 [输入详情] 完整策划对象**：完整的策划JSON

#### 3. 提示词信息
- **📝 [提示词] Prompt 版本**：提示词版本和长度
- **📝 [提示词] 系统提示词**：完整的系统提示词
- **📝 [提示词] 用户提示词**：完整的用户提示词（包含策划结果注入）

#### 4. LLM调用
- **🤖 [LLM调用] 准备调用大模型**：模型信息
- **🤖 [LLM调用] 大模型响应完成**：响应统计和耗时

#### 5. LLM原始输出
- **📤 [LLM原始输出] 未解析的原始响应**：LLM返回的完整内容

#### 6. 解析过程
- **🔧 [解析开始]**：开始解析
- **🔧 [解析方式]**：JSON或文本解析
- **🔧 [解析成功]**：解析后的JSON对象

#### 7. 最终输出
- **📤 [最终输出] 空间布局方案**：
  - `layout`：布局描述
  - `visitorRoute`：具体参观路线数组
  - `zones`：功能区域数组（名称、面积、功能）
  - `accessibility`：无障碍设计说明
  - `totalArea`：各区域总面积

- **📤 [输出详情] 完整空间布局对象**：完整的输出JSON

#### 8. 完成标记
```
═══════════════════════════════════════════════════════════
✅ [空间设计智能体] 空间布局生成完成
- 总耗时
- LLM耗时
- 解析耗时
═══════════════════════════════════════════════════════════
```

---

## 🔍 如何查看日志

### 方法1：控制台输出

启动后端服务后，日志会直接输出到控制台：

```bash
cd backend
npm start
```

在控制台中搜索emoji标签快速定位：
- 搜索 `🎨` 查找策划智能体日志
- 搜索 `🏗️` 查找空间设计智能体日志
- 搜索 `📥` 查看输入
- 搜索 `📤` 查看输出
- 搜索 `📝` 查看提示词
- 搜索 `🤖` 查看LLM调用

### 方法2：日志文件

日志也会写入日志文件（如果配置了文件日志）：

```bash
# 查看最新的策划智能体日志
tail -f logs/curator-agent.log

# 查看最新的空间设计智能体日志
tail -f logs/spatial-designer-agent.log
```

### 方法3：日志级别控制

在 `.env` 文件中调整日志级别：

```bash
# 显示所有日志（包括调试信息）
LOG_LEVEL=debug

# 只显示重要信息
LOG_LEVEL=info

# 只显示警告和错误
LOG_LEVEL=warn
```

---

## 📊 日志示例

### 策划智能体日志示例

```log
═══════════════════════════════════════════════════════════
🎨 [策划智能体] 开始生成概念策划方案
═══════════════════════════════════════════════════════════
📥 [输入参数] 原始需求 {
  exhibitionTitle: "唐代陶瓷艺术展",
  theme: "展示唐代陶瓷的艺术魅力与历史价值",
  targetAudience: "文化爱好者、历史学者、艺术院校师生",
  venueSpace: { area: 500, height: 4, layout: "矩形开放式空间" },
  budget: { total: 500000, currency: "CNY" },
  ...
}
📥 [输入详情] 完整需求对象 {
  "title": "唐代陶瓷艺术展",
  "theme": "展示唐代陶瓷的艺术魅力与历史价值",
  ...
}
📝 [提示词] Prompt 版本 {
  version: "1.1.0",
  systemPromptLength: 2500,
  humanPromptLength: 1800
}
📝 [提示词] 系统提示词 {
  content: "你是专注展陈设计领域的资深策展智能助手..."
}
📝 [提示词] 用户提示词 {
  content: "请为以下展览需求生成概念策划方案：展览标题：唐代陶瓷艺术展..."
}
🤖 [LLM调用] 准备调用大模型 {
  model: "gpt-4",
  temperature: 0.7,
  provider: "openai"
}
🤖 [LLM调用] 大模型响应完成 {
  responseLength: 850,
  llmDuration: "3245ms",
  totalDuration: "3380ms",
  tokenUsage: { prompt_tokens: 2800, completion_tokens: 850 }
}
📤 [LLM原始输出] 未解析的原始响应 {
  content: '{"concept":"窑火千年：唐代陶瓷中的盛世气象与文明互鉴","narrative":"..."}'
}
🔧 [解析方式] 检测到JSON格式，尝试JSON解析
🔧 [解析成功] JSON解析完成 {
  parsed: {
    "concept": "窑火千年：唐代陶瓷中的盛世气象与文明互鉴",
    "narrative": "展览按时间线分为四大板块...",
    "keyExhibits": ["唐三彩马", "邢窑白釉碗", "越窑青瓷莲花碗"],
    "visitorFlow": "采用串联式布局，主展区按时间线线性排列"
  }
}
📤 [最终输出] 概念策划方案 {
  concept: "窑火千年：唐代陶瓷中的盛世气象与文明互鉴",
  narrative: "展览按时间线分为四大板块：初唐的开拓期、盛唐的巅峰期、中唐的变革期、晚唐的传承期...",
  keyExhibits: ["唐三彩马", "邢窑白釉碗", "越窑青瓷莲花碗", "长沙窑诗词壶"],
  visitorFlow: "采用串联式布局，主展区按时间线线性排列，核心展区占比40%"
}
═══════════════════════════════════════════════════════════
✅ [策划智能体] 概念策划生成完成 {
  success: true,
  totalDuration: "3500ms",
  llmDuration: "3245ms",
  parsingDuration: "255ms"
}
═══════════════════════════════════════════════════════════
```

### 空间设计智能体日志示例

```log
═══════════════════════════════════════════════════════════
🏗️ [空间设计智能体] 开始生成空间布局方案
═══════════════════════════════════════════════════════════
📥 [输入参数] 原始需求 {
  exhibitionTitle: "唐代陶瓷艺术展",
  venueSpace: { area: 500, height: 4, layout: "矩形开放式空间" },
  ...
}
📥 [输入参数] 策划方案（来自策划智能体） {
  concept: "窑火千年：唐代陶瓷中的盛世气象与文明互鉴",
  narrative: "展览按时间线分为四大板块：初唐→盛唐→中唐→晚唐",
  keyExhibits: ["唐三彩马", "邢窑白釉碗", "越窑青瓷莲花碗", "长沙窑诗词壶"],
  visitorFlow: "采用串联式布局，主展区按时间线线性排列",
  exhibitsCount: 4
}
📥 [输入详情] 完整策划对象 {
  "concept": "窑火千年：唐代陶瓷中的盛世气象与文明互鉴",
  "narrative": "...",
  "keyExhibits": [...],
  "visitorFlow": "..."
}
📝 [提示词] 系统提示词 {
  content: "你是专注展陈空间设计领域的资深空间规划智能助手..."
}
📝 [提示词] 用户提示词 {
  content: "请为以下展览需求生成空间布局方案：展览标题：唐代陶瓷艺术展...核心概念：窑火千年..."
}
🤖 [LLM调用] 大模型响应完成 {
  responseLength: 1200,
  llmDuration: "4150ms",
  totalDuration: "4320ms"
}
📤 [LLM原始输出] 未解析的原始响应 {
  content: '{"layout":"采用串联式布局，以唐代陶瓷发展时间线为核心叙事线索...","visitorRoute":[...],"zones":[...]}'
}
🔧 [解析成功] JSON解析完成
📤 [最终输出] 空间布局方案 {
  layout: "采用串联式布局，以唐代陶瓷发展时间线为核心叙事线索。入口序厅设置时代背景墙，主展区分为四个递进式展厅...",
  visitorRoute: [
    "入口序厅→初唐展厅→盛唐核心展厅→中唐展厅→晚唐展厅→互动体验区→出口"
  ],
  zones: [
    { name: "入口序厅", area: 50, function: "时代背景介绍、导览图、安检" },
    { name: "初唐展厅", area: 120, function: "展示唐初陶瓷的开拓期特征" },
    { name: "盛唐核心展厅", area: 180, function: "展示盛唐巅峰期" },
    { name: "中唐展厅", area: 150, function: "展示中唐变革期" },
    { name: "晚唐展厅", area: 120, function: "展示晚唐传承期" },
    { name: "互动体验区", area: 80, function: "长沙窑诗词壶互动点" }
  ],
  zoneCount: 6,
  totalArea: 700,
  accessibility: "主通道宽度2米，符合无障碍规范..."
}
═══════════════════════════════════════════════════════════
✅ [空间设计智能体] 空间布局生成完成 {
  success: true,
  totalDuration: "4320ms",
  llmDuration: "4150ms",
  parsingDuration: "170ms"
}
═══════════════════════════════════════════════════════════
```

---

## 🎯 关键信息追踪

### 查看策划如何影响空间设计

1. **查看策划的输出**：
   - 搜索 `📤 [最终输出] 概念策划方案`
   - 记录 `concept`、`narrative`、`keyExhibits`、`visitorFlow`

2. **查看空间设计的输入**：
   - 搜索 `📥 [输入参数] 策划方案（来自策划智能体）`
   - 对比是否接收到了策划的输出

3. **查看提示词如何使用策划结果**：
   - 搜索 `📝 [提示词] 用户提示词`
   - 找到提示词中的 `核心概念：{{concept}}`、`叙事结构：{{narrative}}` 等部分

4. **查看空间设计的最终输出**：
   - 搜索 `📤 [最终输出] 空间布局方案`
   - 对比 `layout` 描述是否体现了策划的 `concept`
   - 对比 `zones` 是否为策划的 `keyExhibits` 分配了展示空间

---

## 💡 调试技巧

### 1. 验证数据传递

如果空间设计没有正确利用策划结果，检查：

```
# 策划智能体输出
📤 [最终输出] 概念策划方案 {
  concept: "...",
  narrative: "...",
  keyExhibits: [...],
  visitorFlow: "..."
}

# 空间设计输入
📥 [输入参数] 策划方案（来自策划智能体） {
  concept: "...",  ← 应该与策划输出一致
  narrative: "...",  ← 应该与策划输出一致
  keyExhibits: [...],  ← 应该与策划输出一致
  visitorFlow: "..."  ← 应该与策划输出一致
}
```

### 2. 验证提示词注入

检查策划结果是否正确注入到空间设计的提示词：

```
📝 [提示词] 用户提示词 {
  content: "...核心概念：窑火千年...叙事结构：展览按时间线..."
                      ↑ 这里应该能看到策划的具体内容
}
```

### 3. 验证LLM推理

查看LLM的原始输出是否基于策划结果：

```
📤 [LLM原始输出] 未解析的原始响应 {
  content: "...基于'窑火千年'的概念，采用串联式布局..."
              ↑ 这里应该体现对策划概念的理解和应用
}
```

---

## 🛠️ 配置文件

### 日志配置

在 `backend/src/utils/logger.ts` 中配置日志：

```typescript
// 调整日志级别
const logLevel = process.env.LOG_LEVEL || 'info';

// 启用/禁用文件日志
const enableFileLog = process.env.ENABLE_FILE_LOG === 'true';

// 日志文件路径
const logFilePath = process.env.LOG_FILE_PATH || './logs';
```

### 环境变量

在 `backend/.env` 中设置：

```bash
# 日志级别: debug | info | warn | error
LOG_LEVEL=debug

# 启用文件日志
ENABLE_FILE_LOG=true

# 日志文件路径
LOG_FILE_PATH=./logs
```

---

## 📈 性能监控

从日志中提取性能指标：

```log
✅ [策划智能体] 概念策划生成完成 {
  totalDuration: "3500ms",     ← 总耗时
  llmDuration: "3245ms",        ← LLM调用耗时
  parsingDuration: "255ms"      ← 解析耗时
}
```

对比不同智能体的性能：
- 策划智能体通常耗时较长（需要创造性思考）
- 空间设计智能体依赖策划结果，但推理相对直接
- 如果 `parsingDuration` 过长，可能需要优化解析逻辑

---

## 🔗 相关文件

- **策划智能体代码**：`backend/src/agents/curator.ts`
- **空间设计智能体代码**：`backend/src/agents/spatial-designer.ts`
- **日志工具**：`backend/src/utils/logger.ts`
- **提示词管理**：`backend/src/prompts/PromptManager.ts`
- **类型定义**：`backend/src/types/exhibition.ts`

---

**更新时间**：2025-01-06
**版本**：1.0.0
